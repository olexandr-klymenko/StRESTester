<scenario>
    <rest name="Create User">
        <method>POST</method>
        <url>{{ auth }}/users/</url>
        <data>{"login": "{{ username }}", "password": "{{ password }}"}</data>
    </rest>
    <rest name="Get Auth Token" return="auth_token">
        <method>POST</method>
        <url>{{ auth }}/tokens/</url>
        <data>{"login": "{{ username }}", "password": "{{ password }}"}</data>
    </rest>
    <rest name="Login" return="jwt_token">
        <method>POST</method>
        <url>{{ api }}/users/login/</url>
        <data>{{ auth_token }}</data>
        <headers>{'content-type': 'application/json'}</headers>
    </rest>
    <get return="jwt_token">
        <info>jwt_token</info>
        <key>token</key>
    </get>
    <rest name="Create Profile" return="user_info">
        <method>POST</method>
        <url>{{ api }}/users/profile/</url>
        <data>{"nickname": "{{ username }}"}</data>
        <headers>{"content-type": "application/json", "Authorization": "Bearer: {{ jwt_token }}"}</headers>
        <raw>True</raw>
    </rest>
    <get return="profile_info">
        <info>user_info</info>
        <key>profile</key>
    </get>
    <get return="profile_id">
        <info>profile_info</info>
        <key>profile_id</key>
    </get>
    <get return="user_id">
        <info>profile_info</info>
        <key>user_id</key>
    </get>
    <repeat cycles="10">
        <rest name="Set user wallet to 10">
            <method>PUT</method>
            <url>{{ api }}/admin/wallet/{{ user_id }}</url>
            <data>{"amount": 10}</data>
            <headers>{"content-type": "application/json"}</headers>
            <raw>True</raw>
        </rest>
        <rest name="Get user wallet">
            <method>GET</method>
            <url>{{ api }}/users/wallet/</url>
            <headers>{"content-type": "application/json", "Authorization": "Bearer: {{ jwt_token }}" }</headers>
        </rest>
        <rest name="Patch money amount">
            <method>PATCH</method>
            <url>{{ api }}/admin/wallet/{{ user_id }}</url>
            <data>{"amount": 10}</data>
            <headers>{"content-type": "application/json"}</headers>
            <raw>True</raw>
        </rest>
    </repeat>
    <rest name="Delete profile">
        <method>DELETE</method>
        <url>{{ api }}/admin/profiles/</url>
        <params>{"profile_id": "{{ profile_id }}", "user_id": "{{ user_id }}"}</params>
    </rest>
    <rest name="Delete User">
        <method>DELETE</method>
        <url>{{ auth }}/users/{{ username }}</url>
    </rest>
</scenario>
